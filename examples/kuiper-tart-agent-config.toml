# Example kuiper-tart-agent configuration
#
# NOTE: For first-time setup, kuiper-tart-agent can bootstrap from CLI arguments:
#   kuiper-tart-agent --coordinator-url https://localhost:9443 \
#              --token REG_TOKEN_FROM_COORDINATOR \
#              --ca-cert /path/to/ca.crt \
#              --labels macos,arm64
#
# This creates a config file automatically. Subsequent runs just need:
#   kuiper-tart-agent
#
# This example config file is for reference or manual setup.

[coordinator]
url = "https://localhost:9443"
hostname = "localhost"

[tls]
# CA certificate from coordinator (copy from coordinator's data dir)
ca_cert = "~/.config/kuiper-tart-agent/certs/ca.crt"
# Directory where agent stores its client certificate after registration
certs_dir = "~/.config/kuiper-tart-agent/certs"

[agent]
# Labels this agent advertises - used for job matching
labels = ["self-hosted", "macos", "arm64", "test-sequoia"]

[tart]
# Base VM image to clone for runners
base_image = "ghcr.io/cirruslabs/macos-sequoia-base:latest"
# Max concurrent VMs (Apple Virtualization limit is 2)
max_concurrent_vms = 2
# GitHub Actions runner version to install (default: "latest")
# Use "latest" to auto-fetch from GitHub API, or pin a specific version
# See https://github.com/actions/runner/releases for available versions
# runner_version = "latest"
# runner_version = "2.321.0"  # pin to specific version

# SSH configuration for connecting to VMs
[tart.ssh]
# SSH username (default: "admin")
username = "admin"
# Authentication method: "password", "key", or "default"
# - "password": use password field below
# - "key": use private_key path below
# - "default": try ~/.ssh/id_ed25519 or ~/.ssh/id_rsa
auth_method = "default"
# Password for password auth (only used if auth_method = "password")
# password = "admin"
# Path to private key (only used if auth_method = "key")
# private_key = "~/.ssh/id_ed25519"
# SSH connection timeout in seconds
timeout_secs = 30

[cleanup]
# Cleanup stale VMs older than this (hours)
max_vm_age_hours = 2
# How often to run cleanup (minutes)
cleanup_interval_mins = 15

[reconnect]
# Initial reconnection delay (seconds)
initial_delay_secs = 1
# Max reconnection delay (seconds)
max_delay_secs = 60
